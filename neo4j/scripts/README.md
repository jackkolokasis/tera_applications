## Run Benchmarks

### Download Datasets

Open "./download-graphalytics-data-sets.sh" and uncommen the specific
line with the specific dataset. Then run:

```sh
./download-graphalytics-data-sets.sh <path/to/download/dataset>
```

### Prepare Benchmark suite
Go to directory
"./../ldbc_graphalytics_platforms_neo4j-master/graphalytics-1.3.0-neo4j-0.1-SNAPSHOT/config/"

1. Set in the "benchmark.properties" file the following variables.

```sh
# Root directory containing graphs on local filesystem
graphs.root-directory =

# Directory to cache derived datasets in (optional, defaults to ${graphs.root-directory}/cache)
graphs.cache-directory =

# Directory to the validation datasets on local filesystem
graphs.validation-directory =

# Directory to the output datasets generated by the system.
graphs.output-directory =

# Your JVM path
benchmark.runner.jvm-path = /path/to/your/jvm
```

2. Set in the "platform.properties" file the following variables.
```sh
# The configurable options of the graph procesing platform.
# Home directory of Neo4j
platform.neo4j.home =
```

3. Set in the "benchmarks/custom.properties" file the following variables.

```sh
# Specify the duration before a benchmark run is timed out.
benchmark.custom.timeout = 20000

# Specify if output and validation is required.
benchmark.custom.output-required = true
benchmark.custom.validation-required = false
```

4. Go to directory "./../ldbc_graphalytics_platforms_neo4j-master/graphalytics-1.3.0-neo4j-0.1-SNAPSHOT/bin/sh"

Add in "load-graph.sh" and "run-benchmark.sh" files the following variables before the import and execution line accordingly.

```sh
export LIBRARY_PATH=/path/to/allocator/lib/:$LIBRARY_PATH
export LD_LIBRARY_PATH=/path/to/allocator/lib/:$LD_LIBRARY_PATH
export PATH=/path/to/allocator/include/:$PATH
export C_INCLUDE_PATH=/path/to/allocator/include/:$C_INCLUDE_PATH
export CPLUS_INCLUDE_PATH=/path/to/allocator/include/:$CPLUS_INCLUDE_PATH

with /path/to being your path to teraheap allocator.

You also can comment out importing in "load-graph.sh" after the first time you created the database in order to save time.
```

5. Edit run.sh and change the user and sudo group in the following
   line. Replace "kolokasis" with your username and "carvsudo" with
   sudo group name in your server.
```sh
sudo cgcreate -a kolokasis:carvsudo -t kolokasis:carvsudo -g memory:memlim

```

### Run Benchmarks

Before running benchmarks you have to set the global configuration
variables in conf.sh

Run the benchmarks with TeraHeap enabled:
```sh
./run.sh -n 1 -o "test" -c
```

Run the benchmarks without TeraHeap enabled:
```sh
./run.sh -n 1 -o "test" -s
```

### Results Output
After the benchmark runs you a directory will be created that contains
the results. The directory form is as follow:

```sh
wcc_140g_14g_th_12:28:23-18-09-2022/
└── wcc
    └── conf0
        └── run0
            ├── bench.log
            ├── benchmark-summary.log
            ├── conf.sh
            ├── diskstat.csv
            ├── diskstats-after-12:44:27-18-09-2022
            ├── diskstats-before-12:28:42-18-09-2022
            ├── iostat-12:28:42-18-09-2022
            ├── jstat.txt
            ├── mpstat-12:28:42-18-09-2022
            ├── parsedate
            ├── plots
            │   ├── avg_qu_sz.png
            │   ├── avg_rq_sz.png
            │   ├── cpu.png
            │   ├── idle_cpu.png
            │   ├── iow_cpu.png
            │   ├── r_thrput.png
            │   ├── sys_cpu.png
            │   ├── thrput.png
            │   ├── user_cpu.png
            │   ├── util.png
            │   └── wr_thrput.png
            ├── result.csv
            ├── serdes.txt
            ├── statistics.csv
            ├── system.csv
            └── teraHeap.txt
```
The main files in the output results directory are the following:

|  File         | Description                                                     |
|:----------:   |:-------------:                                                  |
|result.csv     | Shows time breakdown (e.g., total time, gc time)                |
|diskstat.csv   | Contains read/write statistics for each storage device          |
|statistics.csv | Contains statistics for TeraHeap (e.g., number of objects in H2)|
