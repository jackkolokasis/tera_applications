#!/bin/bash

# will generate n*m queries, with m instances of get_query_terms and n
# queries generated by each instance
workload=$1 # H,M,L,HH,HL,HM,LL,LM,MM
type_workload=$2 # 1 for single term, 2 for and queries
m=$3 # number of processes
n=$4 # number of queries per process

if [ $# -lt 4 ]; then
    echo "Usage: ./query_gen_multicore.sh [workload] [type_workload] [# of processes] [# of queries each] {# of times to repeat generated queries}"
    exit
elif [ $# -eq 5 ]; then
    k=$5
else
    k=1
fi

for i in `seq $m`; do
    ./get_query_terms.sh $workload $type_workload $n > /mnt/shuffle/tmp$i.txt &
done

wait

# combine all the lists
for j in `seq $k`; do
    for i in `seq $m`; do
        cat /mnt/shuffle/tmp$i.txt
    done
done

rm /mnt/shuffle/tmp*
